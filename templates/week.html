{% extends 'base.html' %}

{% block content %}
<script>
function togglePassword(el) {
  const input = el.closest('li').querySelector('input.userpassword');
  if (input.type === 'password') {
    input.type = 'text';
    el.textContent = '󰈈 '; // open eye
  } else {
    input.type = 'password';
    el.textContent = '󰈉 '; // closed eye
  }
}
</script>

<div class="contbox">
  <div style="display: flex; align-items: center; justify-content: space-between;">
    <a href="{{ baseurl+'week/'+str(week-1) }}" class="weeknavb"></a>
    <h2 style="margin-top:1em;">󰃭 {% block title %}Vecka {{ week }}{% endblock %}:<span style="color: #9399b2;font-size:0.8rem;">({{ year }})</span></h2>
    <a href="{{ baseurl+'week/'+str(week+1) }}" class="weeknavb"></a>
  </div>
  <hr>
  {% for i in range(5) %}
  <p class="truncatecont">{{ weekday[i].capitalize() }} {{ datetime.fromtimestamp(weekdata.timestamp() + (i-1)*86400).strftime('%d %b') }}: <span class="truncate" title="{{ schema[i][1] }}">{{ schema[i][1] }}</span>
      {% if userdict['PermissionLevel'] >= 2 %}
      <span class="weekplancontrol" style='float:right;'>
        <a href="{{ schema[i][0]+'set' }}"> </a>
        <a href="{{ schema[i][0]+'del' }}"> </a>
      </span>
      {% endif %}
    </p>
  {% endfor %}
</div>

<div class="contbox">
  <h2> Länkar</h2>
  <hr>
  {% for i in links %}
    <p><a href="{{ baseurl+i.split('-')[0].strip() }}">{{ i.split('-')[1].strip() }}  </a></p>
  {% endfor %}
</div>

<div class="contbox">
  <h2> Inställningar och hantering</h2>
  {% for username in configdict.keys() %}
    <hr style='color: #cdd6f440'>
    <details style='margin-bottom: 5px;'>
      <summary>
        {% if username == userdict['Username'] %}
        <span title="You are logged in as {{ username }}"></span>
        {% endif %}
        {{ username }}
        <span class="weekplancontrol" style='float:right;'>
          <a href="{{ configdict[username]['delete_account'] }}"> </a>
          <a href="{{ configdict[username]['revoke_token'] }}">󰌊</a>
        </span>
      </summary>
      <ul style="margin:0;margin-top:5px;">
        <li style="margin-bottom: 5px;">
          <strong>Password:</strong>
          <input type=password value="{{ configdict[username]['pass'] }}" disabled=true class="userpassword">
          <span class="weekplancontrol" style='float:right;'>
            <a href="{{ configdict[username]['change_password'] }}"> </a>
            <a href="javascript:void(0);" onclick="togglePassword(this)">󰈉 </a>
          </span>
        </li>
        <li><strong>Permissions:</strong>
          {{ list(configdict[username]['auth'].values())[0] }}
          {% if userdict['PermissionLevel'] >= 2 %}
          <span class="weekplancontrol" style='float:right;'>
            <a href="{{ configdict[username]['change_permission']['User'] }}"> </a>
            <a href="{{ configdict[username]['change_permission']['FoodEditor'] }}">󰭼 </a>
            <a href="{{ configdict[username]['change_permission']['Moderator'] }}"> </a>
            <a href="{{ configdict[username]['change_permission']['Admin'] }}"> </a>
          </span>
          {% endif %}
        </li>
      </ul>
    </details>
  {% endfor %}
  {% if configdict.keys().__len__() == 0 %}
    Ej inloggad.
  {% endif %}
</div>

{% endblock %}
